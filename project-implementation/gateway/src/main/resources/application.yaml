spring:
  application:
    name: gateway
  cloud:
    gateway:
      routes:
        # ==================== ACCOUNT SERVICE ROUTES ====================
        - id: account-public-login
          uri: ${ACCOUNT_BASE_URL:http://localhost:8081}
          predicates:
            - Path=/auth/login
            - Method=POST
          filters:
            - RewritePath=/auth/(?<segment>.*), /auth/$\{segment}

        - id: account-public-register
          uri: ${ACCOUNT_BASE_URL:http://localhost:8081}
          predicates:
            - Path=/user/register
            - Method=POST
          filters:
            - RewritePath=/user/(?<segment>.*), /user/$\{segment}

        - id: account-admin-users
          uri: ${ACCOUNT_BASE_URL:http://localhost:8081}
          predicates:
            - Path=/user
            - Method=GET
          filters:
            - RewritePath=/user, /user

        - id: account-user-routes
          uri: ${ACCOUNT_BASE_URL:http://localhost:8081}
          predicates:
            - Path=/user/**, /address/**
          filters:
            - RewritePath=/(?<segment>.*), /$\{segment}

        # ==================== CHECKOUT SERVICE ROUTES ====================
        - id: checkout-coupon-routes
          uri: ${CHECKOUT_BASE_URL:http://localhost:8082}
          predicates:
            - Path=/coupon/**
          filters:
            - RewritePath=/coupon/(?<segment>.*), /coupon/$\{segment}

        - id: checkout-cart-routes
          uri: ${CHECKOUT_BASE_URL:http://localhost:8082}
          predicates:
            - Path=/cart/**
          filters:
            - RewritePath=/cart/(?<segment>.*), /cart/$\{segment}

        # ==================== ORDER SERVICE ROUTES ====================
        - id: order-routes
          uri: ${ORDER_BASE_URL:http://localhost:8084}
          predicates:
            - Path=/order/**
          filters:
            - RewritePath=/order/(?<segment>.*), /order/$\{segment}

        # ==================== STOCK SERVICE ROUTES ====================
        - id: stock-category-routes
          uri: ${STOCK_BASE_URL:http://localhost:8083}
          predicates:
            - Path=/category/**
          filters:
            - RewritePath=/category/(?<segment>.*), /category/$\{segment}

        - id: stock-product-routes
          uri: ${STOCK_BASE_URL:http://localhost:8083}
          predicates:
            - Path=/product/**
          filters:
            - RewritePath=/product/(?<segment>.*), /product/$\{segment}

        # ==================== PAYMENT SERVICE ROUTES ====================
        - id: payment-routes
          uri: ${PAYMENT_BASE_URL:http://localhost:8085}
          predicates:
            - Path=/payment/**
          filters:
            - RewritePath=/payment/(?<segment>.*), /payment/$\{segment}

      default-filters:
        - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin

server:
  port: ${SERVER_PORT:8080}

security:
  jwt:
    secret-key: "${JWT_SECRET:change_this_to_a_long_secret_key_very_secure}"
    access-token-expiration: 3600000 # 1 hour in milliseconds
    refresh-token-expiration: 604800000 # 7 days in milliseconds

management:
  endpoints:
    web:
      exposure:
        include: health, info, prometheus
  endpoint:
    health:
      show-details: always
    prometheus:
      access: read_only
  prometheus:
    metrics:
      export:
        enabled: true

